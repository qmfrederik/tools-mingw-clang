---
- hosts: all
  tasks:
  - name: Install toolchain
    community.general.pacman:
      name: 
      - git
      - make
      - unzip
      - mingw-w64-x86_64-cmake
      - mingw-w64-x86_64-cairo
      - mingw-w64-x86_64-freetype
      - mingw-w64-x86_64-gnutls
      - mingw-w64-x86_64-libxslt
      - mingw-w64-x86_64-icu
      - mingw-w64-x86_64-openjpeg2

  - name: Create ~/pkg directory
    ansible.builtin.file:
      path: ~/pkg/
      state: directory
      mode: '0755'

  - name: Download clang with mingw-fixes for Objective C
    ansible.builtin.unarchive:
      src: https://qmcdn.blob.core.windows.net/gnustep/MINGW64-packages.zip?v2
      dest: ~/pkg/
      remote_src: yes

  - name: Install clang
    community.general.pacman:
      name: 
        - ~/pkg/mingw-w64-x86_64-clang-17.0.6-7-any.pkg.tar.zst
        - ~/pkg/mingw-w64-x86_64-clang-analyzer-17.0.6-7-any.pkg.tar.zst
        - ~/pkg/mingw-w64-x86_64-clang-libs-17.0.6-7-any.pkg.tar.zst
        - ~/pkg/mingw-w64-x86_64-clang-tools-extra-17.0.6-7-any.pkg.tar.zst
        - ~/pkg/mingw-w64-x86_64-compiler-rt-17.0.6-7-any.pkg.tar.zst
        - ~/pkg/mingw-w64-x86_64-lld-17.0.6-7-any.pkg.tar.zst
        - ~/pkg/mingw-w64-x86_64-llvm-17.0.6-7-any.pkg.tar.zst
        - ~/pkg/mingw-w64-x86_64-llvm-libs-17.0.6-7-any.pkg.tar.zst

  - name: Create ~/git directory
    ansible.builtin.file:
      path: ~/git/
      state: directory
      mode: '0755'

  - name: Clone libobjc2
    git: 
      repo: "https://github.com/gnustep/libobjc2"
      dest: ~/git/libobjc2
      version: "master"

  - name: Create ~/git/libobjc2/build directory
    ansible.builtin.file:
      path: ~/git/libobjc2/build
      state: directory
      mode: '0755'

  - name: Clone tools-make
    git: 
      repo: "https://github.com/gnustep/tools-make"
      dest: ~/git/tools-make
      version: "make-2_9_1"

  - name: Clone libs-base
    git: 
      repo: "https://github.com/{{ repo }}/libs-base"
      dest: ~/git/libs-base
      version: "{{ branch }}"

  - name: Clone libs-gui
    git: 
      repo: "https://github.com/{{ repo }}/libs-gui"
      dest: ~/git/libs-gui
      version: "{{ branch }}"

  - name: Clone libs-back repository
    git:
      repo: https://github.com/{{ repo }}/libs-back
      dest: ~/git/libs-back
      version: "{{ branch }}"

  - name: Clone plugins-themes-WinUXTheme repository
    git:
      repo: https://github.com/{{ repo }}/plugins-themes-WinUXTheme
      dest: ~/git/plugins-themes-WinUXTheme
      version: "{{ branch }}"

